#include "spi_chips.h"

#include <stddef.h>

const VendorName_t VendorNames[] = {
    {"Cypress", SpiChipVendor_CYPRESS},
    {"Fujitsu", SpiChipVendor_FUJITSU},
    {"EON", SpiChipVendor_EON},
    {"Atmel", SpiChipVendor_ATMEL},
    {"Micron", SpiChipVendor_MICRON},
    {"AMIC", SpiChipVendor_AMIC},
    {"Sanyo", SpiChipVendor_SANYO},
    {"Intel", SpiChipVendor_INTEL},
    {"ESMT", SpiChipVendor_ESMT},
    {"Fudan", SpiChipVendor_FUDAN},
    {"Hyundai", SpiChipVendor_HYUNDAI},
    {"SST", SpiChipVendor_SST},
    {"GigaDevice", SpiChipVendor_GIGADEVICE},
    {"ISSI", SpiChipVendor_ISSI},
    {"Winbond", SpiChipVendor_WINBOND},
    {"Micronix", SpiChipVendor_MICRONIX},
    {"Nor-Mem", SpiChipVendor_NOR_MEM},
    {"BOYA", SpiChipVendor_BOYA},
    {NULL, 0}};

const ChipInfo_t ChipInfos[] = {
    {"AT25DF161", // TODO: validate!
     SpiChipVendor_ATMEL,
     0x46,
     0x02,
     //2L * 1024L * 1024L,
     512L * 1024L, // FIXME!
     (SpiWriteMode_t)(CHIP_WM_BYTE | CHIP_WM_PAGE_256B),
     256,
     0x81},
    {"BY25Q128AS", // TODO: validate!
     SpiChipVendor_BOYA,
     0x40,
     0x18,
     //16L * 1024L * 1024L, // FIXME
     2L * 1024L * 1024L,
     (SpiWriteMode_t)(CHIP_WM_BYTE | CHIP_WM_PAGE_256B),
     256,
     0x81},
    {"AT45DB161E",
     SpiChipVendor_ATMEL,
     0x26,
     0x00,
     2L * 1024L * 1024L,
     (SpiWriteMode_t)(CHIP_WM_BYTE | CHIP_WM_DUAL_BUFFER),
     512,
     0x81},
    {"W25Q40BV", SpiChipVendor_WINBOND, 0x40, 0x13, 512L * 1024L, CHIP_WM_PAGE_256B, 4096, 0x20},
    {"W25Q16BV",
     SpiChipVendor_WINBOND,
     0x40,
     0x15,
     2L * 1024L * 1024L,
     CHIP_WM_PAGE_256B,
     4096,
     0x20},
    {"W25Q32BV",
     SpiChipVendor_WINBOND,
     0x40,
     0x16,
     4L * 1024L * 1024L,
     //64L * 1024L, // FIXME HACKHACK
     CHIP_WM_PAGE_256B,
     4096,
     0x20},
    {"W25Q64CV",
     SpiChipVendor_WINBOND,
     0x40,
     0x17,
     8L * 1024L * 1024L,
     CHIP_WM_PAGE_256B,
     4096,
     0x20},
    {"W25Q64DW",
     SpiChipVendor_WINBOND,
     0x60,
     0x17,
     8L * 1024L * 1024L,
     CHIP_WM_PAGE_256B,
     4096,
     0x20},
    {"W25Q128BV",
     SpiChipVendor_WINBOND,
     0x40,
     0x18,
     16L * 1024L * 1024L,
     CHIP_WM_PAGE_256B,
     4096,
     0x20},
    {"W25Q256FV",
     SpiChipVendor_WINBOND,
     0x40,
     0x19,
     32L * 1024L * 1024L,
     CHIP_WM_PAGE_256B,
     4096,
     0x20},
    {"SST25VF080B",
     SpiChipVendor_SST,
     0x25,
     0x8E,
     1L * 1024L * 1024L,
     (SpiWriteMode_t)(CHIP_WM_BYTE | CHIP_WM_AAI),
     4096,
     0x20},
    {"SST25VF016B",
     SpiChipVendor_SST,
     0x25,
     0x41,
     2L * 1024L * 1024L,
     (SpiWriteMode_t)(CHIP_WM_BYTE | CHIP_WM_AAI),
     4096,
     0x20},
    {"M25P32",
     SpiChipVendor_MICRON,
     0x20,
     0x16,
     4L * 1024L * 1024L,
     CHIP_WM_PAGE_256B,
     64L * 1024L,
     0xD8},
    {"M25P80",
     SpiChipVendor_MICRON,
     0x20,
     0x14,
     1L * 1024L * 1024L,
     CHIP_WM_PAGE_256B,
     64L * 1024L,
     0xD8},
    {"M25P40", SpiChipVendor_MICRON, 0x20, 0x13, 512L * 1024L, CHIP_WM_PAGE_256B, 64L * 1024L, 0xD8},
    {"EN25Q32B", SpiChipVendor_EON, 0x30, 0x16, 4L * 1024L * 1024L, CHIP_WM_PAGE_256B, 4096, 0x20},
    {"GD25Q64B",
     SpiChipVendor_GIGADEVICE,
     0x40,
     0x17,
     8L * 1024L * 1024L,
     CHIP_WM_PAGE_256B,
     4096,
     0x20},
    {"GD25Q16B",
     SpiChipVendor_GIGADEVICE,
     0x40,
     0x15,
     2L * 1024L * 1024L,
     CHIP_WM_PAGE_256B,
     4096,
     0x20},
    {"GD25Q32C",
     SpiChipVendor_GIGADEVICE,
     0x40,
     0x16,
     4L * 1024L * 1024L,
     CHIP_WM_PAGE_256B,
     4096,
     0x20},
    {"S25FL216K",
     SpiChipVendor_CYPRESS,
     0x40,
     0x15,
     2L * 1024L * 1024L,
     CHIP_WM_PAGE_256B,
     4096,
     0x20},
    {"S25FL032P",
     SpiChipVendor_CYPRESS,
     0x02,
     0x15,
     4L * 1024L * 1024L,
     CHIP_WM_PAGE_256B,
     4096,
     0x20},
    {"A25L080", SpiChipVendor_AMIC, 0x30, 0x14, 1L * 1024L * 1024L, CHIP_WM_PAGE_256B, 4096, 0x20},
    {"F25L004",
     SpiChipVendor_ESMT,
     0x20,
     0x13,
     512L * 1024L,
     (SpiWriteMode_t)(CHIP_WM_BYTE | CHIP_WM_AAI),
     4096,
     0x20},
    {"PCT25VF016B",
     SpiChipVendor_SST,
     0x25,
     0x41,
     2L * 1024L * 1024L,
     (SpiWriteMode_t)(CHIP_WM_BYTE | CHIP_WM_AAI),
     4096,
     0x20},
    {"NM25Q128EV",
     SpiChipVendor_NOR_MEM,
     0x21,
     0x18,
     16L * 1024L * 1024L,
     CHIP_WM_PAGE_256B,
     4096,
     0x20},
    {NULL, 0, 0, 0, 0}};

const char* spi_vendor_get_name(const uint8_t code) {
    for(const VendorName_t* vendor = VendorNames; vendor->name != NULL; ++vendor) {
        if(vendor->id == code) {
            return vendor->name;
        }
    }
    return "UNKNOWN";
}

const ChipInfo_t* spi_chip_get_details(const uint8_t vid, const uint8_t tid, const uint8_t capid) {
    for(const ChipInfo_t* chip = ChipInfos; chip->name != NULL; ++chip) {
        if(chip->vendor_id == vid && chip->type_id == tid && chip->capacity_id == capid) {
            return chip;
        }
    }
    return NULL;
}